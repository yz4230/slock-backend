CREATE TABLE IF NOT EXISTS users (created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL, updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL, id uuid PRIMARY KEY, "name" VARCHAR(64) NOT NULL, "password" VARCHAR(72) NOT NULL, email VARCHAR(128) NOT NULL);
CREATE TABLE IF NOT EXISTS sessions (created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL, updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL, id uuid PRIMARY KEY, user_id uuid NOT NULL, expires_at TIMESTAMP NOT NULL, CONSTRAINT fk_sessions_user_id__id FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE RESTRICT ON UPDATE RESTRICT);
CREATE TABLE IF NOT EXISTS channels (created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL, updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL, id uuid PRIMARY KEY, "name" VARCHAR(64) NOT NULL, description VARCHAR(1024) NOT NULL, is_direct BOOLEAN DEFAULT FALSE NOT NULL);
CREATE TABLE IF NOT EXISTS participates (created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL, updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL, user_id uuid, channel_id uuid, CONSTRAINT pk_participates PRIMARY KEY (user_id, channel_id), CONSTRAINT fk_participates_user_id__id FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE RESTRICT ON UPDATE RESTRICT, CONSTRAINT fk_participates_channel_id__id FOREIGN KEY (channel_id) REFERENCES channels(id) ON DELETE RESTRICT ON UPDATE RESTRICT);
CREATE TABLE IF NOT EXISTS messages (created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL, updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL, id uuid PRIMARY KEY, user_id uuid NOT NULL, channel_id uuid NOT NULL, thread_id uuid NULL, "content" VARCHAR(1024) NOT NULL);
CREATE TABLE IF NOT EXISTS attachments (created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL, updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL, id uuid PRIMARY KEY, message_id uuid NOT NULL, filename VARCHAR(128) NOT NULL, "path" TEXT NOT NULL);
CREATE TABLE IF NOT EXISTS reactions (created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL, updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL, id uuid PRIMARY KEY, message_id uuid NOT NULL, user_id uuid NOT NULL, emoji VARCHAR(64) NOT NULL);
ALTER TABLE messages ADD CONSTRAINT fk_messages_user_id__id FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE RESTRICT ON UPDATE RESTRICT;
ALTER TABLE messages ADD CONSTRAINT fk_messages_channel_id__id FOREIGN KEY (channel_id) REFERENCES channels(id) ON DELETE RESTRICT ON UPDATE RESTRICT;
ALTER TABLE messages ADD CONSTRAINT fk_messages_thread_id__id FOREIGN KEY (thread_id) REFERENCES messages(id) ON DELETE RESTRICT ON UPDATE RESTRICT;
ALTER TABLE attachments ADD CONSTRAINT fk_attachments_message_id__id FOREIGN KEY (message_id) REFERENCES messages(id) ON DELETE RESTRICT ON UPDATE RESTRICT;
ALTER TABLE reactions ADD CONSTRAINT fk_reactions_message_id__id FOREIGN KEY (message_id) REFERENCES messages(id) ON DELETE RESTRICT ON UPDATE RESTRICT;
ALTER TABLE reactions ADD CONSTRAINT fk_reactions_user_id__id FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE RESTRICT ON UPDATE RESTRICT;
